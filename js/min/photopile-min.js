var photopile=function(){function i(){$(".js div.photopile-wrapper").css({"background-repeat":"no-repeat","background-position":"50%, 50%","background-image":"url("+w+")"}),$("ul.photopile").children().each(function(){m.init($(this))}),A.init(),$(window).load(function(){$(".js div.photopile-wrapper").css({padding:n+"px","background-image":"none"}).children().css({opacity:"0",display:"inline-block"}).fadeTo(h,1),k.init(),g&&t()})}function t(){var i=$("ul.photopile").children().first();window.setInterval(function(){i.children().first().click(),i=i.hasClass("last")?$("ul.photopile").children().first():i.next()},v)}var e=6,n=50,o=30,s=2,c="white",a="#EAEAEA",l=!0,h=10,r=500,f=500,d=10,p="white",u=!0,g=!1,v=5e3,w="images/loading.gif",m={active:"photopile-active-thumbnail",init:function(i){if(self=this,i.children().css("padding",s+"px"),self.bindUIActions(i),self.setRotation(i),self.setOverlap(i),self.setRandomZ(i),l){var t=0,n=0;i.draggable({start:function(){i.addClass("preventClick"),i.css("z-index",e+2),$("ul.photopile").children().each(function(){i.unbind("mouseover",self.bringToTop),i.unbind("mouseout",self.moveDownOne)})},drag:function(e,o){n=1.2*(o.offset.left-t),ratio=parseInt(100*n/360),i.css("transform","rotateZ("+ratio+"deg)"),t=o.offset.left},stop:function(){i.css("z-index",e+1),$("ul.photopile").children().each(function(){i.bind("mouseover",self.bringToTop),i.bind("mouseout",self.moveDownOne)})}})}i.css("background",c)},bindUIActions:function(i){var t=this;i.bind("mouseover",t.bringToTop),i.bind("mouseout",t.moveDownOne),i.click(function(i){if(i.preventDefault(),$(this).hasClass("preventClick"))$(this).removeClass("preventClick");else{if($(this).hasClass(t.active))return;A.pickup($(this))}}),i.mousedown(function(){$(this).removeClass("preventClick")})},bringToTop:function(){$(this).css({"z-index":e+1,background:a})},moveDownOne:function(){$(this).css({"z-index":e,background:c})},setOverlap:function(i){i.css("margin",-1*n/2+"px")},setZ:function(i,t){i.css("z-index",t)},setRandomZ:function(i){i.css({"z-index":Math.floor(Math.random()*e+1)})},setRotation:function(i){var t=-1*o,e=o,n=Math.floor(Math.random()*(e-t+1))+t;i.css({transform:"rotate("+n+"deg)"})},setActive:function(i){i.addClass(this.active)},getActiveOffset:function(){return $("li."+this.active).offset()},getActiveHeight:function(){return $("li."+this.active).height()},getActiveWidth:function(){return $("li."+this.active).width()},getActiveImgSrc:function(){return $("li."+this.active).children().first().attr("href")},getActiveRotation:function(){var i=$("li."+this.active).css("transform"),t=i.split("(")[1].split(")")[0].split(","),e=Math.round(Math.asin(t[1])*(180/Math.PI));return e},getActive:function(){return $("li."+this.active)[0]?$("li."+this.active).first():!1},getActiveShift:function(){return this.getActiveRotation()<0?-(.4*this.getActiveRotation(m)):.4*this.getActiveRotation(m)},clearActiveClass:function(){$("li."+this.active).fadeTo(h,1).removeClass(this.active)}},A={container:$('<div id="photopile-active-image-container"/>'),image:$('<img id="photopile-active-image" />'),info:$('<div id="photopile-active-image-info"/>'),isPickedUp:!1,fullSizeWidth:null,fullSizeHeight:null,windowPadding:40,init:function(){$("body").append(this.container),this.container.css({display:"none",position:"absolute",padding:s,"z-index":f,background:p,"background-image":"url("+w+")","background-repeat":"no-repeat","background-position":"50%, 50%"}),this.container.append(this.image),this.image.css("display","block"),u&&(this.container.append(this.info),this.info.append("<p></p>"),this.info.css("opacity","0"))},pickup:function(i){var t=this;t.isPickedUp?t.putDown(function(){t.pickup(i)}):(t.isPickedUp=!0,m.clearActiveClass(),m.setActive(i),t.loadImage(m.getActiveImgSrc(),function(){t.image.fadeTo(h,"1"),t.enlarge(),$("body").bind("click",function(){t.putDown()})}))},putDown:function(i){self=this,$("body").unbind(),self.hideInfo(),k.hideControls(),m.setZ(m.getActive(),e),self.container.stop().animate({top:m.getActiveOffset().top+m.getActiveShift(),left:m.getActiveOffset().left+m.getActiveShift(),width:m.getActiveWidth()+"px",height:m.getActiveHeight()+"px",padding:s+"px"},r,function(){self.isPickedUp=!1,m.clearActiveClass(),self.container.fadeOut(h,function(){i&&i()})})},loadImage:function(i,t){var e=this;e.image.css("opacity","0"),e.startPosition();var n=new Image;n.src=i,n.onload=function(){e.fullSizeWidth=this.width,e.fullSizeHeight=this.height,e.setImageSource(i),t&&t()}},startPosition:function(){this.container.css({top:m.getActiveOffset().top+m.getActiveShift(),left:m.getActiveOffset().left+m.getActiveShift(),transform:"rotate("+m.getActiveRotation()+"deg)",width:m.getActiveWidth()+"px",height:m.getActiveHeight()+"px",padding:s}).fadeTo(h,"1"),m.getActive().fadeTo(h,"0")},enlarge:function(){var i=window.innerHeight?window.innerHeight:$(window).height(),t=$(window).width()-2*this.windowPadding,e=i-2*this.windowPadding;t<this.fullSizeWidth&&e<this.fullSizeHeight?t*(this.fullSizeHeight/this.fullSizeWidth)>e?this.enlargeToWindowHeight(e):this.enlargeToWindowWidth(t):t<this.fullSizeWidth?this.enlargeToWindowWidth(t):e<this.fullSizeHeight?this.enlargeToWindowHeight(e):this.enlargeToFullSize()},showInfo:function(){u&&(this.info.children().text(m.getActive().children("a").children("img").attr("alt")),this.info.css({"margin-top":-this.info.height()+"px"}).fadeTo(h,1))},hideInfo:function(){u&&this.info.fadeTo(h,0)},enlargeToFullSize:function(){self=this,self.container.css("transform","rotate(0deg)").animate({top:$(window).scrollTop()+$(window).height()/2-self.fullSizeHeight/2,left:$(window).scrollLeft()+$(window).width()/2-self.fullSizeWidth/2,width:self.fullSizeWidth-2*d+"px",height:self.fullSizeHeight-2*d+"px",padding:d+"px"},function(){self.showInfo(),k.showControls()})},enlargeToWindowWidth:function(i){self=this;var t=i*(self.fullSizeHeight/self.fullSizeWidth);self.container.css("transform","rotate(0deg)").animate({top:$(window).scrollTop()+$(window).height()/2-t/2,left:$(window).scrollLeft()+$(window).width()/2-i/2,width:i+"px",height:t+"px",padding:d+"px"},function(){self.showInfo(),k.showControls()})},enlargeToWindowHeight:function(i){self=this;var t=i*(self.fullSizeWidth/self.fullSizeHeight);self.container.css("transform","rotate(0deg)").animate({top:$(window).scrollTop()+$(window).height()/2-i/2,left:$(window).scrollLeft()+$(window).width()/2-t/2,width:t+"px",height:i+"px",padding:d+"px"},function(){self.showInfo(),k.showControls()})},setImageSource:function(i){this.image.attr("src",i).css({width:"100%",height:"100%","margin-top":"0"})}},k={next:$('<div id="photopile-nav-next" />'),prev:$('<div id="photopile-nav-prev" />'),init:function(){A.container.append(this.next),A.container.append(this.prev),$("ul.photopile li:first").addClass("first"),$("ul.photopile li:last").addClass("last"),this.bindUIActions()},bindUIActions:function(){this.next.click(function(i){i.preventDefault(),k.pickupNext()}),this.prev.click(function(i){i.preventDefault(),k.pickupPrev()}),$(document.documentElement).keyup(function(i){39==i.keyCode&&k.pickupNext(),37==i.keyCode&&k.pickupPrev()})},pickupNext:function(){var i=m.getActive();i&&A.pickup(i.hasClass("last")?$("ul.photopile").children().first():i.next("li"))},pickupPrev:function(){var i=m.getActive();i&&A.pickup(i.hasClass("first")?$("ul.photopile").children().last():i.prev("li"))},hideControls:function(){this.next.css("opacity","0"),this.prev.css("opacity","0")},showControls:function(){this.next.css("opacity","100"),this.prev.css("opacity","100")}};return{scatter:i,autoplay:t}}();photopile.scatter();