var photopile=function(){function q(){$(".js div.photopile-wrapper").css({"background-repeat":"no-repeat","background-position":"50%, 50%","background-image":"url("+p+")"}),$("ul.photopile").children().each(function(){s.init($(this))}),t.init(),$(window).load(function(){$(".js div.photopile-wrapper").css({padding:b+"px","background-image":"none"}).children().css({opacity:"0",display:"inline-block"}).fadeTo(h,1),u.init(),n&&r()})}function r(){var a=$("ul.photopile").children().first();window.setInterval(function(){a.children().first().click(),a=a.hasClass("last")?$("ul.photopile").children().first():a.next()},o)}var a=6,b=50,c=30,d=2,e="white",f="#EAEAEA",g=!0,h=10,i=500,j=500,k=10,l="white",m=!0,n=!1,o=5e3,p="images/loading.gif",s={active:"photopile-active-thumbnail",init:function(b){if(self=this,b.children().css("padding",d+"px"),self.bindUIActions(b),self.setRotation(b),self.setOverlap(b),self.setRandomZ(b),g){var c=0,f=0;b.draggable({start:function(){b.addClass("preventClick"),b.css("z-index",a+2),$("ul.photopile").children().each(function(){b.unbind("mouseover",self.bringToTop),b.unbind("mouseout",self.moveDownOne)})},drag:function(a,d){f=1.2*(d.offset.left-c),ratio=parseInt(100*f/360),b.css("transform","rotateZ("+ratio+"deg)"),c=d.offset.left},stop:function(){b.css("z-index",a+1),$("ul.photopile").children().each(function(){b.bind("mouseover",self.bringToTop),b.bind("mouseout",self.moveDownOne)})}})}b.css("background",e)},bindUIActions:function(a){var b=this;a.bind("mouseover",b.bringToTop),a.bind("mouseout",b.moveDownOne),a.click(function(a){if(a.preventDefault(),$(this).hasClass("preventClick"))$(this).removeClass("preventClick");else{if($(this).hasClass(b.active))return;t.pickup($(this))}}),a.mousedown(function(){$(this).removeClass("preventClick")})},bringToTop:function(){$(this).css({"z-index":a+1,background:f})},moveDownOne:function(){$(this).css({"z-index":a,background:e})},setOverlap:function(a){a.css("margin",-1*b/2+"px")},setZ:function(a,b){a.css("z-index",b)},setRandomZ:function(b){b.css({"z-index":Math.floor(Math.random()*a+1)})},setRotation:function(a){var b=-1*c,d=c,e=Math.floor(Math.random()*(d-b+1))+b;a.css({transform:"rotate("+e+"deg)"})},setActive:function(a){a.addClass(this.active)},getActiveOffset:function(){return $("li."+this.active).offset()},getActiveHeight:function(){return $("li."+this.active).height()},getActiveWidth:function(){return $("li."+this.active).width()},getActiveImgSrc:function(){return $("li."+this.active).children().first().attr("href")},getActiveRotation:function(){var a=$("li."+this.active).css("transform"),b=a.split("(")[1].split(")")[0].split(","),c=Math.round(Math.asin(b[1])*(180/Math.PI));return c},getActive:function(){return $("li."+this.active)[0]?$("li."+this.active).first():!1},getActiveShift:function(){return this.getActiveRotation()<0?-(.4*this.getActiveRotation(s)):.4*this.getActiveRotation(s)},clearActiveClass:function(){$("li."+this.active).fadeTo(h,1).removeClass(this.active)}},t={container:$('<div id="photopile-active-image-container"/>'),image:$('<img id="photopile-active-image" />'),info:$('<div id="photopile-active-image-info"/>'),isPickedUp:!1,fullSizeWidth:null,fullSizeHeight:null,windowPadding:40,init:function(){$("body").append(this.container),this.container.css({display:"none",position:"absolute",padding:d,"z-index":j,background:l,"background-image":"url("+p+")","background-repeat":"no-repeat","background-position":"50%, 50%"}),this.container.append(this.image),this.image.css("display","block"),m&&(this.container.append(this.info),this.info.append("<p></p>"),this.info.css("opacity","0"))},pickup:function(a){var b=this;b.isPickedUp?b.putDown(function(){b.pickup(a)}):(b.isPickedUp=!0,s.clearActiveClass(),s.setActive(a),b.loadImage(s.getActiveImgSrc(),function(){b.image.fadeTo(h,"1"),b.enlarge(),$("body").bind("click",function(){b.putDown()})}))},putDown:function(b){self=this,$("body").unbind(),self.hideInfo(),u.hideControls(),s.setZ(s.getActive(),a),self.container.stop().animate({top:s.getActiveOffset().top+s.getActiveShift(),left:s.getActiveOffset().left+s.getActiveShift(),width:s.getActiveWidth()+"px",height:s.getActiveHeight()+"px",padding:d+"px"},i,function(){self.isPickedUp=!1,s.clearActiveClass(),self.container.fadeOut(h,function(){b&&b()})})},loadImage:function(a,b){var c=this;c.image.css("opacity","0"),c.startPosition();var d=new Image;d.src=a,d.onload=function(){c.fullSizeWidth=this.width,c.fullSizeHeight=this.height,c.setImageSource(a),b&&b()}},startPosition:function(){this.container.css({top:s.getActiveOffset().top+s.getActiveShift(),left:s.getActiveOffset().left+s.getActiveShift(),transform:"rotate("+s.getActiveRotation()+"deg)",width:s.getActiveWidth()+"px",height:s.getActiveHeight()+"px",padding:d}).fadeTo(h,"1"),s.getActive().fadeTo(h,"0")},enlarge:function(){var a=window.innerHeight?window.innerHeight:$(window).height(),b=$(window).width()-2*this.windowPadding,c=a-2*this.windowPadding;b<this.fullSizeWidth&&c<this.fullSizeHeight?b*(this.fullSizeHeight/this.fullSizeWidth)>c?this.enlargeToWindowHeight(c):this.enlargeToWindowWidth(b):b<this.fullSizeWidth?this.enlargeToWindowWidth(b):c<this.fullSizeHeight?this.enlargeToWindowHeight(c):this.enlargeToFullSize()},showInfo:function(){m&&(this.info.children().text(s.getActive().children("a").children("img").attr("alt")),this.info.css({"margin-top":-this.info.height()+"px"}).fadeTo(h,1))},hideInfo:function(){m&&this.info.fadeTo(h,0)},enlargeToFullSize:function(){self=this,self.container.css("transform","rotate(0deg)").animate({top:$(window).scrollTop()+$(window).height()/2-self.fullSizeHeight/2,left:$(window).scrollLeft()+$(window).width()/2-self.fullSizeWidth/2,width:self.fullSizeWidth-2*k+"px",height:self.fullSizeHeight-2*k+"px",padding:k+"px"},function(){self.showInfo(),u.showControls()})},enlargeToWindowWidth:function(a){self=this;var b=a*(self.fullSizeHeight/self.fullSizeWidth);self.container.css("transform","rotate(0deg)").animate({top:$(window).scrollTop()+$(window).height()/2-b/2,left:$(window).scrollLeft()+$(window).width()/2-a/2,width:a+"px",height:b+"px",padding:k+"px"},function(){self.showInfo(),u.showControls()})},enlargeToWindowHeight:function(a){self=this;var b=a*(self.fullSizeWidth/self.fullSizeHeight);self.container.css("transform","rotate(0deg)").animate({top:$(window).scrollTop()+$(window).height()/2-a/2,left:$(window).scrollLeft()+$(window).width()/2-b/2,width:b+"px",height:a+"px",padding:k+"px"},function(){self.showInfo(),u.showControls()})},setImageSource:function(a){this.image.attr("src",a).css({width:"100%",height:"100%","margin-top":"0"})}},u={next:$('<div id="photopile-nav-next" />'),prev:$('<div id="photopile-nav-prev" />'),init:function(){t.container.append(this.next),t.container.append(this.prev),$("ul.photopile li:first").addClass("first"),$("ul.photopile li:last").addClass("last"),this.bindUIActions()},bindUIActions:function(){this.next.click(function(a){a.preventDefault(),u.pickupNext()}),this.prev.click(function(a){a.preventDefault(),u.pickupPrev()}),$(document.documentElement).keyup(function(a){39==a.keyCode&&u.pickupNext(),37==a.keyCode&&u.pickupPrev()})},pickupNext:function(){var a=s.getActive();a&&(a.hasClass("last")?t.pickup($("ul.photopile").children().first()):t.pickup(a.next("li")))},pickupPrev:function(){var a=s.getActive();a&&(a.hasClass("first")?t.pickup($("ul.photopile").children().last()):t.pickup(a.prev("li")))},hideControls:function(){this.next.css("opacity","0"),this.prev.css("opacity","0")},showControls:function(){this.next.css("opacity","100"),this.prev.css("opacity","100")}};return{scatter:q,autoplay:r}}();photopile.scatter();